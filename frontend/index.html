<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Ingichka Taksi</title>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- Leaflet Map -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <link rel="stylesheet" href="./style.css" />
</head>

<body>

  <!-- BACKGROUND LAYERS -->
  <div class="bg"></div>
  <div class="grain"></div>

  <!-- LOADING -->
  <div id="loading" class="loading active">
    <div class="loading-card glass-soft">
      <div class="taxi-road">
        <div class="taxi-car"></div>
      </div>
      <div class="loading-text">LOADING</div>
      <div class="loading-sub">created by <b>711 GROUP</b></div>
    </div>
  </div>

  <!-- APP ROOT -->
  <div id="app" class="app">

    <!-- TOP BAR -->
    <header class="topbar">
      <div class="brand">
        <div class="brand-icon">ğŸš•</div>
        <div class="brand-title">Ingichka Taksi</div>
      </div>
      <button class="icon-btn" onclick="openSheet('settingsSheet')" aria-label="Settings">âš™ï¸</button>
    </header>

    <!-- SCREENS -->
    <main class="screens">

      <!-- SCREEN: LANGUAGE -->
      <section id="screen-language" class="screen active">
        <div class="center-card glass">
          <h1 class="title" data-i18n="choose_lang">Tilni tanlang</h1>

          <div class="stack">
            <button class="btn primary" onclick="setLang('uz')">Oâ€˜zbek</button>
            <button class="btn" onclick="setLang('ru')">Ğ ÑƒÑÑĞºĞ¸Ğ¹</button>
            <button class="btn" onclick="setLang('uzk')">ĞĞ·Ğ±ĞµĞºÑ‡Ğ°</button>
          </div>

          <p class="muted" data-i18n="lang_hint">
            Tilni keyin sozlamalardan oâ€˜zgartirsa boâ€˜ladi.
          </p>
        </div>
      </section>

      <!-- SCREEN: ROLE -->
      <section id="screen-role" class="screen">
        <div class="center-card glass">
          <h1 class="title" data-i18n="choose_role">Rolin tanlang</h1>

          <div class="stack">
            <button class="btn primary" onclick="selectRole('driver')">ğŸš˜ <span data-i18n="role_driver">Haydovchi</span></button>
            <button class="btn" onclick="selectRole('client')">ğŸ‘¤ <span data-i18n="role_client">Mijoz</span></button>
          </div>

          <button class="link" onclick="goBackTo('screen-language')">â† <span data-i18n="back">Orqaga</span></button>
        </div>
      </section>

      <!-- SCREEN: PROFILE SETUP -->
      <section id="screen-profile" class="screen">
        <div class="sheet glass">
          <h2 class="sheet-title" data-i18n="profile_setup">Profilni toâ€˜ldirish</h2>

          <div class="form-grid">
            <label class="field">
              <span data-i18n="full_name">Ism familiya</span>
              <input id="p-name" placeholder="Temur Qodirov" />
            </label>

            <label class="field">
              <span data-i18n="phone">Telefon</span>
              <input id="p-phone" placeholder="+998..." inputmode="tel" />
            </label>

            <button class="btn" style="margin-top:6px;" onclick="requestContact()">
              ğŸ“² Telefonni Telegramdan olish
            </button>
            <div class="muted small" id="contactHint" style="margin-top:6px; display:none;">
              âœ… Telefon avtomatik toâ€˜ldirildi
            </div>

            <div id="driver-extra" class="driver-extra">
              <label class="field">
                <span data-i18n="car_brand">Mashina markasi</span>
                <input id="p-car-brand" placeholder="Chevrolet Nexia" />
              </label>

              <label class="field">
                <span data-i18n="car_number">Mashina raqami</span>
                <input id="p-car-number" placeholder="01ABC123" />
              </label>
            </div>

            <label class="field">
              <span data-i18n="photo_url">Foto (URL)</span>
              <input id="p-photo" placeholder="https://..." />
            </label>

            <label class="field">
              <span data-i18n="about_short">Qisqa info</span>
              <input id="p-bio" placeholder="..." />
            </label>
          </div>

          <div class="row">
            <button class="btn primary full" onclick="saveProfile()" data-i18n="continue">Davom etish</button>
          </div>

          <div class="row">
            <button class="link" onclick="goBackTo('screen-role')">â† <span data-i18n="back">Orqaga</span></button>
          </div>
        </div>
      </section>

      <!-- SCREEN: HOME -->
      <section id="screen-home" class="screen">
        <div class="tabs glass">
          <button id="tabDrivers" class="tab active" onclick="switchFeed('drivers')">
            ğŸš˜ <span data-i18n="drivers">Haydovchilar</span>
          </button>
          <button id="tabClients" class="tab" onclick="switchFeed('clients')">
            ğŸ‘¤ <span data-i18n="clients">Mijozlar</span>
          </button>
        </div>

        <div class="feed-header glass">
          <div class="feed-left">
            <div class="mini" id="geoLine">ğŸ“ <span data-i18n="geo_off">Geolokatsiya: OFF</span></div>
            <div class="mini" id="sortLine">â†•ï¸ <span data-i18n="sort_time">Saralash: vaqt</span></div>
          </div>
          <div class="feed-right">
            <button class="chip" onclick="toggleSort()"><span data-i18n="sort">Saralash</span></button>
            <button class="chip" onclick="openSheet('geoSheet')">ğŸ“ <span data-i18n="geo">Geo</span></button>
            <button class="chip" onclick="openFullMap()">ğŸ—º Full Map</button>
          </div>
        </div>

        <!-- SEARCH + FILTER -->
        <div class="searchbar glass">
          <input id="qInput" class="search-input" placeholder="ğŸ” Search driver / route..." oninput="applySearch()" />
          <button class="chip" onclick="openSheet('filterSheet')">âš¡ Filter</button>
        </div>

        <div id="cards" class="cards">
          <div class="skeleton glass"></div>
          <div class="skeleton glass"></div>
          <div class="skeleton glass"></div>
        </div>
      </section>

      <!-- SCREEN: PROFILE VIEW -->
      <section id="screen-profile-view" class="screen">
        <div class="profile glass">
          <div class="profile-top">
            <div class="avatar" id="avatar"></div>
            <div class="profile-info">
              <div class="p-name" id="pv-name">â€”</div>
              <div class="p-sub" id="pv-phone">â€”</div>
              <div class="p-sub" id="pv-car">â€”</div>
            </div>
          </div>

          <div class="profile-stats">
            <div class="stat glass-soft">
              <div class="stat-label" data-i18n="rating">Reyting</div>
              <div class="stat-value" id="pv-rating">0.0 â­</div>
            </div>
            <div class="stat glass-soft">
              <div class="stat-label" data-i18n="points">Pointlar</div>
              <div class="stat-value" id="pv-points">0 ğŸ†</div>
            </div>
          </div>

          <div class="profile-actions">
            <button class="btn" onclick="openSheet('editProfileSheet')" data-i18n="edit_profile">Profilni tahrirlash</button>
            <button class="btn" onclick="openSheet('myAdsSheet')" data-i18n="my_ads">Mening eâ€™lonlarim</button>
            <button class="btn" onclick="openSheet('ordersSheet'); loadMyOrders();">ğŸ§¾ Order history</button>
          </div>
        </div>
      </section>

      <!-- SCREEN: ADMIN -->
      <section id="screen-admin" class="screen">
        <div class="sheet glass">
          <h2 class="sheet-title">ğŸ›¡ Admin Panel</h2>
          <p class="muted">711 GROUP control center</p>

          <div class="admin-grid">
            <button class="btn" onclick="adminRefresh()">ğŸ“Š Stats</button>
            <button class="btn" onclick="adminLoadProfiles()">ğŸ‘¥ Users</button>
            <button class="btn danger" onclick="adminClearAds()">ğŸ—‘ Cleanup</button>
          </div>

          <div class="mini muted" id="adminStats">â€”</div>

          <div id="adminUsers" class="cards" style="margin-top:12px;"></div>

          <div class="sheet glass" style="margin-top:12px;">
            <h3 style="margin:0 0 10px;">ğŸ“£ Banner</h3>

            <div class="form-grid compact">
              <label class="field">
                <span>Title</span>
                <input id="banTitle" placeholder="Promo title..." />
              </label>

              <label class="field">
                <span>Text</span>
                <input id="banText" placeholder="Promo text..." />
              </label>

              <label class="field">
                <span>Image URL</span>
                <input id="banImage" placeholder="https://..." />
              </label>

              <label class="field">
                <span>Link (optional)</span>
                <input id="banLink" placeholder="https://..." />
              </label>

              <div class="row2">
                <button class="btn primary" onclick="adminSetBanner()">âœ… Publish</button>
                <button class="btn danger" onclick="adminBannerOff()">ğŸ›‘ OFF</button>
              </div>
            </div>
          </div>

        </div>
      </section>

      <!-- SCREEN: FULLSCREEN MAP -->
      <section id="screen-map-full" class="screen">
        <div class="map-full-wrap">
          <div class="map-full-top glass">
            <div class="sheet-head-title">ğŸ—º Map</div>
            <button class="icon-btn" onclick="closeFullMap()">âœ•</button>
          </div>
          <div id="mapFullBox" class="map-full-box"></div>
        </div>
      </section>

    </main>

    <!-- BOTTOM NAV -->
    <nav class="bottom glass">
      <button class="nav-btn active" id="navHome" onclick="nav('home')">
        <div class="nav-ico">ğŸ </div>
        <div class="nav-txt" data-i18n="nav_home">Bosh</div>
      </button>

      <button class="nav-btn" id="navCreate" onclick="openSheet('createAdSheet')">
        <div class="nav-ico big">ï¼‹</div>
        <div class="nav-txt" data-i18n="nav_create">Yaratish</div>
      </button>

      <button class="nav-btn" id="navProfile" onclick="nav('profile')">
        <div class="nav-ico">ğŸ‘¤</div>
        <div class="nav-txt" data-i18n="nav_profile">Profil</div>
      </button>

      <button class="nav-btn" id="navSettings" onclick="openSheet('settingsSheet')">
        <div class="nav-ico">âš™ï¸</div>
        <div class="nav-txt" data-i18n="nav_settings">Sozlamalar</div>
      </button>
    </nav>

  </div>

  <!-- ======= BOTTOM SHEETS ======= -->

  <!-- CREATE AD SHEET -->
  <div id="createAdSheet" class="sheet-wrap" onclick="sheetOutside(event,'createAdSheet')">
    <div class="bottom-sheet glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title" data-i18n="create_ad">Eâ€™lon yaratish</div>
        <button class="icon-btn" onclick="closeSheet('createAdSheet')">âœ•</button>
      </div>

      <div class="form-grid compact">
        <div class="row2">
          <label class="field">
            <span data-i18n="point_a">TOCHKA A</span>
            <input id="ad-from" placeholder="Chirchiq" />
          </label>
          <label class="field">
            <span data-i18n="point_b">TOCHKA B</span>
            <input id="ad-to" placeholder="Sergeli" />
          </label>
        </div>

        <label class="field">
          <span data-i18n="ad_type">Tur</span>
          <select id="ad-type">
            <option value="now" data-i18n="type_now">SRAZU EDI</option>
            <option value="20" data-i18n="type_20">20 daqiqada</option>
            <option value="fill" data-i18n="type_fill">Odam toâ€˜lsa</option>
          </select>
        </label>

        <div class="row2">
          <label class="field">
            <span data-i18n="price">Narx</span>
            <input id="ad-price" placeholder="10000" inputmode="numeric" />
          </label>
          <label class="field">
            <span data-i18n="seats">Boâ€˜sh joy</span>
            <input id="ad-seats" placeholder="3" inputmode="numeric" />
          </label>
        </div>

        <label class="field">
          <span data-i18n="comment">Izoh</span>
          <input id="ad-comment" placeholder="..." />
        </label>

        <div class="row2">
          <button class="btn primary" onclick="publishAd()" data-i18n="publish">Eâ€™lon berish</button>
          <button class="btn" onclick="closeSheet('createAdSheet')" data-i18n="close">Yopish</button>
        </div>

        <p class="muted small" data-i18n="auto_delete">
          Eâ€™lon 60 daqiqadan soâ€˜ng avtomatik oâ€˜chadi.
        </p>
      </div>
    </div>
  </div>

  <!-- SETTINGS SHEET -->
  <div id="settingsSheet" class="sheet-wrap" onclick="sheetOutside(event,'settingsSheet')">
    <div class="bottom-sheet glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title" data-i18n="settings">Sozlamalar</div>
        <button class="icon-btn" onclick="closeSheet('settingsSheet')">âœ•</button>
      </div>

      <div class="settings-list">
        <button class="setting-item" onclick="openSheet('langSheet')">
          ğŸŒ <span data-i18n="language">Til</span>
          <span class="right" id="langBadge">uz</span>
        </button>

        <div class="setting-item">
          ğŸ”” <span data-i18n="notifications">Bildirishnomalar</span>
          <label class="switch">
            <input id="notifyToggle" type="checkbox" />
            <span class="slider"></span>
          </label>
        </div>

        <button class="setting-item" onclick="openSheet('donateSheet')">
          ğŸ’› <span data-i18n="donate">Donat</span>
          <span class="right">711</span>
        </button>

        <button class="setting-item" onclick="openSheet('aboutSheet')">
          âœ¨ <span data-i18n="about">Biz haqimizda</span>
          <span class="right">i</span>
        </button>

        <button class="setting-item" onclick="openSheet('topDriversSheet'); loadTopDrivers();">
          ğŸ† <span>Top Drivers</span>
          <span class="right">â†’</span>
        </button>

        <button class="setting-item admin-only" onclick="nav('admin')">
          ğŸ›¡ Admin Panel
          <span class="right">â†’</span>
        </button>
      </div>

      <div class="sheet-foot muted small">
        created by <b>711 GROUP</b>
      </div>
    </div>
  </div>

  <!-- LANGUAGE SHEET -->
  <div id="langSheet" class="sheet-wrap" onclick="sheetOutside(event,'langSheet')">
    <div class="bottom-sheet glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title" data-i18n="language">Til</div>
        <button class="icon-btn" onclick="closeSheet('langSheet')">âœ•</button>
      </div>
      <div class="stack">
        <button class="btn" onclick="setLang('uz'); closeSheet('langSheet')">Oâ€˜zbek</button>
        <button class="btn" onclick="setLang('ru'); closeSheet('langSheet')">Ğ ÑƒÑÑĞºĞ¸Ğ¹</button>
        <button class="btn" onclick="setLang('uzk'); closeSheet('langSheet')">ĞĞ·Ğ±ĞµĞºÑ‡Ğ°</button>
      </div>
    </div>
  </div>

  <!-- GEO SHEET -->
  <div id="geoSheet" class="sheet-wrap" onclick="sheetOutside(event,'geoSheet')">
    <div class="bottom-sheet glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title">ğŸ“ <span data-i18n="geo">Geolokatsiya</span></div>
        <button class="icon-btn" onclick="closeSheet('geoSheet')">âœ•</button>
      </div>

      <div class="setting-item">
        ğŸ“ <span data-i18n="geo_enable">Geo yoqish</span>
        <label class="switch">
          <input id="geoToggle" type="checkbox" />
          <span class="slider"></span>
        </label>
      </div>

      <div class="mini muted" id="geoStatus">â€”</div>

      <button class="btn" onclick="updateLocationNow()" data-i18n="geo_update">Joylashuvni yangilash</button>

      <p class="muted small" data-i18n="geo_hint">
        Geo yoqilsa, eâ€™lonlar sizga yaqinligi boâ€˜yicha saralanadi.
      </p>
    </div>
  </div>

  <!-- ABOUT SHEET -->
  <div id="aboutSheet" class="sheet-wrap" onclick="sheetOutside(event,'aboutSheet')">
    <div class="bottom-sheet glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title" data-i18n="about">Biz haqimizda</div>
        <button class="icon-btn" onclick="closeSheet('aboutSheet')">âœ•</button>
      </div>

      <div class="about-card">
        <div class="about-shape shape1"></div>
        <div class="about-shape shape2"></div>

        <h3>Ingichka Taksi</h3>
        <p class="muted" data-i18n="about_text">
          Bu mini-ilova kichik shahar uchun: tez eâ€™lon, tez qoâ€˜ngâ€˜iroq, qulay tanlash.
        </p>

        <div class="about-pill">created by <b>711 GROUP</b></div>
      </div>
    </div>
  </div>

  <!-- DONATE SHEET -->
  <div id="donateSheet" class="sheet-wrap" onclick="sheetOutside(event,'donateSheet')">
    <div class="bottom-sheet glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title" data-i18n="donate">Donat</div>
        <button class="icon-btn" onclick="closeSheet('donateSheet')">âœ•</button>
      </div>

      <div class="donate-card glass-soft">
        <h3>ğŸ’› 711 GROUP</h3>
        <p class="muted" data-i18n="donate_text">
          Loyiha rivoji uchun qoâ€˜llab-quvvatlang. Sizning donatingiz server va yangilanishlarga ketadi.
        </p>

        <button class="btn primary full" onclick="donateNow()" data-i18n="donate_btn">
          Donat qilish
        </button>
      </div>
    </div>
  </div>

  <!-- EDIT PROFILE -->
  <div id="editProfileSheet" class="sheet-wrap" onclick="sheetOutside(event,'editProfileSheet')">
    <div class="bottom-sheet glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title" data-i18n="edit_profile">Profilni tahrirlash</div>
        <button class="icon-btn" onclick="closeSheet('editProfileSheet')">âœ•</button>
      </div>

      <div class="form-grid compact">
        <label class="field">
          <span data-i18n="full_name">Ism familiya</span>
          <input id="ep-name" />
        </label>

        <label class="field">
          <span data-i18n="phone">Telefon</span>
          <input id="ep-phone" />
        </label>

        <label class="field">
          <span data-i18n="car_brand">Mashina markasi</span>
          <input id="ep-car-brand" />
        </label>

        <label class="field">
          <span data-i18n="car_number">Mashina raqami</span>
          <input id="ep-car-number" />
        </label>

        <label class="field">
          <span data-i18n="photo_url">Foto (URL)</span>
          <input id="ep-photo" />
        </label>

        <div class="row2">
          <button class="btn primary" onclick="saveProfileEdit()" data-i18n="save">Saqlash</button>
          <button class="btn" onclick="closeSheet('editProfileSheet')" data-i18n="close">Yopish</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MY ADS -->
  <div id="myAdsSheet" class="sheet-wrap" onclick="sheetOutside(event,'myAdsSheet')">
    <div class="bottom-sheet glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title" data-i18n="my_ads">Mening eâ€™lonlarim</div>
        <button class="icon-btn" onclick="closeSheet('myAdsSheet')">âœ•</button>
      </div>

      <div id="myAdsList" class="cards small-cards"></div>
    </div>
  </div>

  <!-- ORDERS -->
  <div id="ordersSheet" class="sheet-wrap" onclick="sheetOutside(event,'ordersSheet')">
    <div class="bottom-sheet glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title">ğŸ§¾ Orders</div>
        <button class="icon-btn" onclick="closeSheet('ordersSheet')">âœ•</button>
      </div>
      <div id="ordersList" class="cards small-cards"></div>
    </div>
  </div>

  <!-- TOP DRIVERS -->
  <div id="topDriversSheet" class="sheet-wrap" onclick="sheetOutside(event,'topDriversSheet')">
    <div class="bottom-sheet glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title">ğŸ† Top Drivers</div>
        <button class="icon-btn" onclick="closeSheet('topDriversSheet')">âœ•</button>
      </div>
      <div id="topDriversList" class="cards"></div>
    </div>
  </div>

  <!-- FILTER SHEET -->
  <div id="filterSheet" class="sheet-wrap" onclick="sheetOutside(event,'filterSheet')">
    <div class="bottom-sheet glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title">âš¡ Filters</div>
        <button class="icon-btn" onclick="closeSheet('filterSheet')">âœ•</button>
      </div>

      <div class="form-grid compact">
        <div class="row2">
          <label class="field"><span>Price min</span><input id="fPriceMin" placeholder="0" inputmode="numeric" /></label>
          <label class="field"><span>Price max</span><input id="fPriceMax" placeholder="50000" inputmode="numeric" /></label>
        </div>

        <div class="row2">
          <label class="field"><span>Seats â‰¥</span><input id="fSeats" placeholder="1" inputmode="numeric" /></label>
          <label class="field"><span>Rating â‰¥</span><input id="fRating" placeholder="4.0" inputmode="decimal" /></label>
        </div>

        <label class="field">
          <span>Only Online Drivers</span>
          <select id="fOnline">
            <option value="1">Yes</option>
            <option value="0">No</option>
          </select>
        </label>

        <label class="field">
          <span>Near me radius (km)</span>
          <select id="fRadius">
            <option value="0">Any</option>
            <option value="2">2 km</option>
            <option value="5">5 km</option>
            <option value="10">10 km</option>
            <option value="20">20 km</option>
          </select>
        </label>

        <div class="row2">
          <button class="btn primary" onclick="saveFilters()">âœ… Apply</button>
          <button class="btn" onclick="resetFilters()">â™» Reset</button>
        </div>
      </div>
    </div>
  </div>

  <!-- PROMO BANNER -->
  <div id="bannerModal" class="sheet-wrap" onclick="sheetOutside(event,'bannerModal')">
    <div class="bottom-sheet glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title">ğŸ“£ Reklama</div>
        <button class="icon-btn" onclick="closeSheet('bannerModal')">âœ•</button>
      </div>

      <div id="bannerBody" class="banner-card"></div>

      <div class="row2" style="margin-top:10px;">
        <button class="btn" onclick="hideBannerToday()">ğŸ•’ Bugun koâ€˜rsatma</button>
        <button class="btn primary" onclick="openBannerLink()">ğŸ”— Ochish</button>
      </div>
    </div>
  </div>

  <script defer src="./app.js"></script>
</body>
</html>
