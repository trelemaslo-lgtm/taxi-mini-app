<!DOCTYPE html>
<html lang="uz" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Ingichka Taksi â€” ULTRA</title>

  <!-- Telegram -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- Leaflet (Map) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <link rel="stylesheet" href="./style.css" />
</head>

<body>

  <!-- BACKGROUND -->
  <div class="bg"></div>
  <div class="grain"></div>

  <!-- LOADING -->
  <div id="loading" class="loading active">
    <div class="loading-card glass">
      <div class="taxi-road">
        <div class="taxi-car"></div>
      </div>
      <div class="loading-text">LOADING</div>
      <div class="loading-sub">created by <b>711 GROUP</b></div>
    </div>
  </div>

  <!-- APP ROOT -->
  <div id="app" class="app">

    <!-- TOPBAR -->
    <header class="topbar glass">
      <div class="brand">
        <div class="brand-chip">
          <div class="brand-ico">ğŸš•</div>
        </div>
        <div class="brand-titles">
          <div class="brand-title">Ingichka Taksi</div>
          <div class="brand-sub">ULTRA Liquid Glass</div>
        </div>
      </div>

      <div class="top-actions">
        <button id="themeBtn" class="icon-btn" title="Theme">ğŸŒ™</button>
        <button class="icon-btn" onclick="openSheet('settingsSheet')" title="Settings">âš™ï¸</button>
      </div>
    </header>

    <!-- SCREENS -->
    <main class="screens">

      <!-- SCREEN: ROLE -->
      <section id="screen-role" class="screen">
        <div class="center-card glass">
          <h1 class="title">Rolin tanlang</h1>

          <div class="stack">
            <button class="btn primary" onclick="selectRole('driver')">ğŸš˜ Haydovchi</button>
            <button class="btn" onclick="selectRole('client')">ğŸ‘¤ Mijoz</button>
          </div>

          <p class="muted small" style="margin-top:12px;">
            Keyin Sozlamalardan rolni almashtirish mumkin.
          </p>
        </div>
      </section>

      <!-- SCREEN: PROFILE SETUP -->
      <section id="screen-profile" class="screen">
        <div class="sheet glass">
          <h2 class="sheet-title">Profilni toâ€˜ldirish</h2>

          <div class="form-grid">
            <label class="field">
              <span>Ism Familiya</span>
              <input id="p-name" placeholder="Temur Qodirov" />
            </label>

            <label class="field">
              <span>Telefon</span>
              <input id="p-phone" placeholder="+998..." inputmode="tel" />
            </label>

            <div id="driver-extra" class="driver-extra">
              <label class="field">
                <span>Mashina markasi</span>
                <input id="p-car-brand" placeholder="Chevrolet Nexia" />
              </label>

              <label class="field">
                <span>Mashina raqami</span>
                <input id="p-car-number" placeholder="01ABC123" />
              </label>
            </div>

            <!-- DEVICE UPLOAD ONLY -->
            <label class="field">
              <span>Profil rasmi (Device upload)</span>
              <input id="p-photo-file" type="file" accept="image/*"/>
              <div class="muted small">URL yoâ€˜q âŒ â€” faqat qurilmadan âœ…</div>
            </label>

            <label class="field">
              <span>Qisqa info</span>
              <input id="p-bio" placeholder="..." />
            </label>
          </div>

          <div class="row">
            <button class="btn primary full" onclick="saveProfile()">Davom etish</button>
          </div>

          <div class="row">
            <button class="btn full" onclick="requestContact()">ğŸ“ Contact Share (Telegram)</button>
          </div>

          <div class="row">
            <button class="link" onclick="goBackTo('screen-role')">â† Orqaga</button>
          </div>
        </div>
      </section>

      <!-- SCREEN: HOME / FEED -->
      <section id="screen-home" class="screen">
        <!-- search -->
        <div class="searchbar glass">
          <input id="searchInput" placeholder="ğŸ” Haydovchi / marshrut / raqam..." />
          <button class="chip" onclick="openSheet('filterSheet')">ğŸ› Filter</button>
        </div>

        <div class="tabs glass">
          <button id="tabDrivers" class="tab active" onclick="switchFeed('drivers')">
            ğŸš˜ Haydovchilar
          </button>
          <button id="tabClients" class="tab" onclick="switchFeed('clients')">
            ğŸ‘¤ Mijozlar
          </button>
        </div>

        <div class="feed-header glass">
          <div class="feed-left">
            <div class="mini" id="geoLine">ğŸ“ Geolokatsiya: OFF</div>
            <div class="mini" id="sortLine">â†•ï¸ Saralash: vaqt</div>
          </div>
          <div class="feed-right" style="display:flex;gap:8px;">
            <button class="chip" onclick="toggleSort()">â†•ï¸ Sort</button>
            <button class="chip" onclick="openSheet('geoSheet')">ğŸ“ Geo</button>
          </div>
        </div>

        <div id="cards" class="cards">
          <div class="skeleton glass"></div>
          <div class="skeleton glass"></div>
          <div class="skeleton glass"></div>
        </div>
      </section>

      <!-- SCREEN: MAP -->
      <section id="screen-map" class="screen">
        <div class="glass" style="padding:12px;margin-bottom:10px;">
          <div style="font-weight:950;">ğŸ—º Map Mode</div>
          <div class="muted small" style="margin-top:6px;">
            Radius boâ€˜yicha yaqin eâ€™lonlar.
          </div>

          <div style="margin-top:12px;">
            <div class="muted small">Radius: <span id="radiusVal">5</span> km</div>
            <input id="radiusSlider" type="range" min="1" max="30" value="5" style="width:100%;">
          </div>

          <div style="margin-top:10px;display:flex;gap:10px;">
            <button class="btn primary full" onclick="loadMapAds()">ğŸ”„ Update Map</button>
          </div>
        </div>

        <div id="mapBox" class="map-box glass"></div>
      </section>

      <!-- SCREEN: CHAT -->
      <section id="screen-chat" class="screen">
        <div class="sheet glass">
          <h2 class="sheet-title" id="chatPeer">ğŸ’¬ Chat</h2>
          <div id="typingLine" class="muted small" style="margin-bottom:8px;"></div>

          <div id="chatRoom" class="chat-room glass-soft"></div>

          <div class="chat-input-row">
            <input id="chatInput" placeholder="Xabar yozing..." oninput="__typing()"/>
            <button class="btn primary" onclick="__sendMsg()">â–¶</button>
          </div>

          <div class="row">
            <button class="btn full" onclick="nav('home')">â¬…ï¸ Orqaga</button>
          </div>
        </div>
      </section>

      <!-- SCREEN: PROFILE VIEW -->
      <section id="screen-profile-view" class="screen">
        <div class="profile glass">
          <div class="profile-cover">
            <div class="cover-overlay"></div>
          </div>

          <div class="profile-top">
            <div class="avatar big" id="avatar">ğŸ‘¤</div>
            <div style="flex:1;">
              <div class="p-name" id="pv-name">â€”</div>
              <div class="p-sub" id="pv-phone">â€”</div>
              <div class="p-sub" id="pv-car">â€”</div>
              <div id="pv-rolechip" class="role-chip glass-soft">â€”</div>
            </div>
          </div>

          <div class="profile-stats">
            <div class="stat glass-soft">
              <div class="stat-label">Reyting</div>
              <div class="stat-value" id="pv-rating">0.0 â­</div>
            </div>
            <div class="stat glass-soft">
              <div class="stat-label">Pointlar</div>
              <div class="stat-value" id="pv-points">0 ğŸ†</div>
            </div>
          </div>

          <!-- CAR GALLERY -->
          <div style="margin-top:12px;">
            <div style="font-weight:950;margin-bottom:8px;">ğŸš˜ Car Gallery</div>
            <div class="muted small">Faqat device upload âœ…</div>

            <div style="display:flex;gap:10px;margin-top:10px;">
              <input id="carPhotoFiles" type="file" accept="image/*" multiple style="flex:1;">
              <button class="btn primary" onclick="uploadCarPhotos()">Upload</button>
            </div>

            <div id="carGallery" class="car-gallery"></div>
          </div>

          <div class="profile-actions">
            <button class="btn" onclick="openSheet('editProfileSheet')">Profilni tahrirlash</button>
            <button class="btn" onclick="openSheet('myAdsSheet')">Mening eâ€™lonlarim</button>
          </div>
        </div>
      </section>

      <!-- SCREEN: ADMIN -->
      <section id="screen-admin" class="screen">
        <div class="sheet glass">
          <h2 class="sheet-title">ğŸ›¡ Admin Panel</h2>
          <p class="muted small">Faqat Admin Telegram ID orqali ochiladi.</p>

          <div class="admin-grid">
            <button class="btn" onclick="adminRefresh()">ğŸ”„ Refresh</button>
            <button class="btn danger" onclick="adminClearAll()">ğŸ—‘ Clear ALL</button>
          </div>

          <div class="muted small" id="adminStats" style="margin-top:12px;">â€”</div>

          <div style="margin-top:16px;">
            <div style="font-weight:950;margin-bottom:8px;">ğŸ“¢ Entry Banner</div>
            <div class="muted small">Keyin backend bilan full ishlatamiz.</div>
            <button class="btn primary full" onclick="adminUploadBanner()">Upload Banner</button>
          </div>

          <div class="row">
            <button class="btn full" onclick="nav('home')">â¬…ï¸ Orqaga</button>
          </div>
        </div>
      </section>

    </main>

    <!-- BOTTOM NAV -->
    <nav class="bottom glass">
      <button class="nav-btn active" id="navHome" onclick="nav('home')">
        <div class="nav-ico">ğŸ </div>
        <div class="nav-txt">Bosh</div>
      </button>

      <button class="nav-btn" id="navCreate" onclick="openSheet('createAdSheet')">
        <div class="nav-ico big">ï¼‹</div>
        <div class="nav-txt">Yaratish</div>
      </button>

      <button class="nav-btn" id="navMap" onclick="nav('map')">
        <div class="nav-ico">ğŸ—º</div>
        <div class="nav-txt">Map</div>
      </button>

      <button class="nav-btn" id="navProfile" onclick="nav('profile')">
        <div class="nav-ico">ğŸ‘¤</div>
        <div class="nav-txt">Profil</div>
      </button>
    </nav>

  </div>


  <!-- ============== SHEETS ============== -->

  <!-- CREATE AD -->
  <div id="createAdSheet" class="sheet-wrap" onclick="sheetOutside(event,'createAdSheet')">
    <div class="bottom-sheet glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title">ğŸ“ Eâ€™lon yaratish</div>
        <button class="icon-btn" onclick="closeSheet('createAdSheet')">âœ•</button>
      </div>

      <div class="form-grid compact">

        <div class="row2">
          <label class="field">
            <span>TOCHKA A</span>
            <input id="ad-from" placeholder="Chirchiq" />
          </label>
          <label class="field">
            <span>TOCHKA B</span>
            <input id="ad-to" placeholder="Sergeli" />
          </label>
        </div>

        <label class="field">
          <span>Tur</span>
          <select id="ad-type">
            <option value="now">SRAZU EDI</option>
            <option value="20">20 daqiqada</option>
            <option value="fill">Odam toâ€˜lsa</option>
          </select>
        </label>

        <div class="row2">
          <label class="field">
            <span>Narx</span>
            <input id="ad-price" placeholder="10 000" inputmode="numeric" />
          </label>
          <label class="field">
            <span>Boâ€˜sh joy</span>
            <input id="ad-seats" placeholder="3" inputmode="numeric" />
          </label>
        </div>

        <label class="field">
          <span>Izoh</span>
          <input id="ad-comment" placeholder="..." />
        </label>

        <div class="row2">
          <button class="btn primary" onclick="publishAd()">âœ… Eâ€™lon berish</button>
          <button class="btn" onclick="closeSheet('createAdSheet')">Yopish</button>
        </div>

        <p class="muted small">
          â³ Eâ€™lon 60 daqiqadan soâ€˜ng avtomatik oâ€˜chadi.
        </p>
      </div>
    </div>
  </div>

  <!-- SETTINGS -->
  <div id="settingsSheet" class="sheet-wrap" onclick="sheetOutside(event,'settingsSheet')">
    <div class="bottom-sheet glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title">âš™ï¸ Sozlamalar</div>
        <button class="icon-btn" onclick="closeSheet('settingsSheet')">âœ•</button>
      </div>

      <div class="settings-list">

        <div class="setting-item">
          ğŸ¨ Theme
          <span class="right muted small">Dark/Light</span>
        </div>

        <div class="setting-item">
          ğŸ”” Notifications
          <label class="switch">
            <input id="notifyToggle" type="checkbox" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="setting-item">
          ğŸ”Š Sound Effects
          <label class="switch">
            <input id="sfxToggle" type="checkbox" />
            <span class="slider"></span>
          </label>
        </div>

        <button class="setting-item admin-only" onclick="closeSheet('settingsSheet'); nav('admin')">
          ğŸ›¡ Admin Panel
          <span class="right">â†’</span>
        </button>

        <button class="setting-item" onclick="openSheet('geoSheet')">
          ğŸ“ Geo Settings
          <span class="right">â†’</span>
        </button>

      </div>

      <div class="sheet-foot muted small">
        created by <b>711 GROUP</b>
      </div>
    </div>
  </div>

  <!-- GEO -->
  <div id="geoSheet" class="sheet-wrap" onclick="sheetOutside(event,'geoSheet')">
    <div class="bottom-sheet glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title">ğŸ“ Geolokatsiya</div>
        <button class="icon-btn" onclick="closeSheet('geoSheet')">âœ•</button>
      </div>

      <div class="setting-item">
        ğŸ“ Geo yoqish
        <label class="switch">
          <input id="geoToggle" type="checkbox" />
          <span class="slider"></span>
        </label>
      </div>

      <div class="mini muted" id="geoStatus">â€”</div>

      <button class="btn primary full" onclick="updateLocationNow()">ğŸ“ Joylashuvni yangilash</button>

      <p class="muted small" style="margin-top:10px;">
        Geo ON boâ€˜lsa, saralash masofa boâ€˜yicha ishlaydi.
      </p>
    </div>
  </div>

  <!-- FILTER SHEET -->
  <div id="filterSheet" class="sheet-wrap" onclick="sheetOutside(event,'filterSheet')">
    <div class="bottom-sheet glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title">ğŸ› Filter</div>
        <button class="icon-btn" onclick="closeSheet('filterSheet')">âœ•</button>
      </div>

      <div class="form-grid compact">
        <label class="field">
          <span>Max narx</span>
          <input id="f-price" placeholder="20000" inputmode="numeric" />
        </label>

        <label class="field">
          <span>Min seats</span>
          <input id="f-seats" placeholder="2" inputmode="numeric" />
        </label>

        <div class="row2">
          <button class="btn primary" onclick="applyFilter()">âœ… Apply</button>
          <button class="btn" onclick="resetFilter()">â™» Reset</button>
        </div>
      </div>
    </div>
  </div>

  <!-- EDIT PROFILE -->
  <div id="editProfileSheet" class="sheet-wrap" onclick="sheetOutside(event,'editProfileSheet')">
    <div class="bottom-sheet glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title">âœï¸ Profilni tahrirlash</div>
        <button class="icon-btn" onclick="closeSheet('editProfileSheet')">âœ•</button>
      </div>

      <div class="form-grid compact">
        <label class="field">
          <span>Ism familiya</span>
          <input id="ep-name" />
        </label>

        <label class="field">
          <span>Telefon</span>
          <input id="ep-phone" />
        </label>

        <label class="field">
          <span>Mashina markasi</span>
          <input id="ep-car-brand" />
        </label>

        <label class="field">
          <span>Mashina raqami</span>
          <input id="ep-car-number" />
        </label>

        <label class="field">
          <span>Profil rasmi (Device upload)</span>
          <input id="ep-photo-file" type="file" accept="image/*" />
          <div class="muted small">URL yoâ€˜q âŒ â€” device âœ…</div>
        </label>

        <div class="row2">
          <button class="btn primary" onclick="saveProfileEdit()">âœ… Saqlash</button>
          <button class="btn" onclick="closeSheet('editProfileSheet')">Yopish</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MY ADS -->
  <div id="myAdsSheet" class="sheet-wrap" onclick="sheetOutside(event,'myAdsSheet')">
    <div class="bottom-sheet glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title">ğŸ“Œ Mening eâ€™lonlarim</div>
        <button class="icon-btn" onclick="closeSheet('myAdsSheet')">âœ•</button>
      </div>

      <div id="myAdsList" class="cards small-cards"></div>
    </div>
  </div>

  <script defer src="./app.js"></script>
</body>
</html>
