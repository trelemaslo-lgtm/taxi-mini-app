<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Ingichka Taksi</title>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <!-- BACKGROUND -->
  <div class="bg"></div>
  <div class="grain"></div>

  <!-- LOADING -->
  <div id="loading" class="loading active">
    <div class="loading-card glass">
      <div class="taxi-road">
        <div class="taxi-car"></div>
      </div>
      <div class="loading-text">LOADING</div>
      <div class="loading-sub">created by <b>711 GROUP</b></div>
    </div>
  </div>

  <!-- APP -->
  <div id="app" class="app hidden">

    <!-- TOP BAR -->
    <header class="topbar">
      <div class="brand">
        <div class="brand-icon">ğŸš•</div>
        <div>
          <div class="brand-title">Ingichka Taksi</div>
          <div class="brand-sub" id="onlineBadge">â— online</div>
        </div>
      </div>

      <div class="top-actions">
        <button class="icon-btn" onclick="toggleTheme()" title="Theme">ğŸŒ“</button>
        <button class="icon-btn" onclick="openSheet('settingsSheet')" title="Settings">âš™ï¸</button>
      </div>
    </header>

    <!-- SCREENS -->
    <main class="screens">

      <!-- LANGUAGE -->
      <section id="screen-language" class="screen active">
        <div class="center-card glass">
          <h1 class="title" data-i18n="choose_lang">Tilni tanlang</h1>

          <div class="stack">
            <button class="btn primary" onclick="setLang('uz')">Oâ€˜zbek</button>
            <button class="btn" onclick="setLang('ru')">Ğ ÑƒÑÑĞºĞ¸Ğ¹</button>
            <button class="btn" onclick="setLang('uzk')">ĞĞ·Ğ±ĞµĞºÑ‡Ğ°</button>
          </div>

          <p class="muted" data-i18n="lang_hint">
            Tilni keyin sozlamalardan oâ€˜zgartirsa boâ€˜ladi.
          </p>
        </div>
      </section>

      <!-- ROLE -->
      <section id="screen-role" class="screen">
        <div class="center-card glass">
          <h1 class="title" data-i18n="choose_role">Rolin tanlang</h1>

          <div class="stack">
            <button class="btn primary" onclick="selectRole('driver')">ğŸš˜ <span data-i18n="role_driver">Haydovchi</span></button>
            <button class="btn" onclick="selectRole('client')">ğŸ‘¤ <span data-i18n="role_client">Mijoz</span></button>
          </div>

          <button class="link" onclick="goBackTo('screen-language')">â† <span data-i18n="back">Orqaga</span></button>
        </div>
      </section>

      <!-- PROFILE SETUP -->
      <section id="screen-profile" class="screen">
        <div class="sheet glass">
          <h2 class="sheet-title" data-i18n="profile_setup">Profilni toâ€˜ldirish</h2>

          <div class="form-grid">
            <label class="field">
              <span data-i18n="full_name">Ism familiya</span>
              <input id="p-name" placeholder="Temur Qodirov" />
            </label>

            <label class="field">
              <span data-i18n="phone">Telefon</span>
              <input id="p-phone" placeholder="+998..." inputmode="tel" />
            </label>

            <div id="driver-extra" class="driver-extra">
              <label class="field">
                <span data-i18n="car_brand">Mashina markasi</span>
                <input id="p-car-brand" placeholder="Chevrolet Cobalt" />
              </label>

              <label class="field">
                <span data-i18n="car_number">Mashina raqami</span>
                <input id="p-car-number" placeholder="01A123AB" />
              </label>
            </div>

            <!-- DEVICE UPLOAD ONLY -->
            <label class="field">
              <span data-i18n="photo_upload">Profil rasmi (qurilmadan)</span>
              <input id="p-photo-file" type="file" accept="image/*" />
              <div class="preview-row">
                <div class="avatar-preview" id="p-photo-preview"></div>
                <div class="mini muted" data-i18n="photo_note">
                  URL yoâ€˜q. Faqat qurilmadan yuklanadi âœ…
                </div>
              </div>
            </label>

            <label class="field">
              <span data-i18n="about_short">Qisqa info</span>
              <input id="p-bio" placeholder="Tez va arzon yoâ€˜l!" />
            </label>
          </div>

          <div class="row">
            <button class="btn primary full" onclick="saveProfile()" data-i18n="continue">Davom etish</button>
          </div>

          <div class="row">
            <button class="link" onclick="goBackTo('screen-role')">â† <span data-i18n="back">Orqaga</span></button>
          </div>
        </div>
      </section>

      <!-- HOME -->
      <section id="screen-home" class="screen">
        <div class="tabs glass">
          <button id="tabDrivers" class="tab active" onclick="switchFeed('drivers')">
            ğŸš˜ <span data-i18n="drivers">Haydovchilar</span>
          </button>
          <button id="tabClients" class="tab" onclick="switchFeed('clients')">
            ğŸ‘¤ <span data-i18n="clients">Mijozlar</span>
          </button>
        </div>

        <div class="feed-header glass">
          <div class="feed-left">
            <div class="mini" id="geoLine">ğŸ“ <span data-i18n="geo_off">Geolokatsiya: OFF</span></div>
            <div class="mini" id="sortLine">â†•ï¸ <span data-i18n="sort_time">Saralash: vaqt</span></div>
          </div>

          <div class="feed-right">
            <button class="chip" onclick="toggleSort()">â†•ï¸ <span data-i18n="sort">Saralash</span></button>
            <button class="chip" onclick="openSheet('geoSheet')">ğŸ“ <span data-i18n="geo">Geo</span></button>
            <button class="chip" onclick="openSheet('searchSheet')">ğŸ” <span data-i18n="search">Qidirish</span></button>
          </div>
        </div>

        <div id="cards" class="cards">
          <div class="skeleton glass"></div>
          <div class="skeleton glass"></div>
          <div class="skeleton glass"></div>
        </div>
      </section>

      <!-- PROFILE VIEW -->
      <section id="screen-profile-view" class="screen">
        <div class="profile glass">
          <div class="profile-top">
            <div class="avatar xl" id="avatar"></div>
            <div class="profile-info">
              <div class="p-name" id="pv-name">â€”</div>
              <div class="p-sub" id="pv-phone">â€”</div>
              <div class="p-sub" id="pv-car">â€”</div>
              <div class="plate" id="pv-plate">â€”</div>
            </div>
          </div>

          <div class="profile-stats">
            <div class="stat glass-soft">
              <div class="stat-label" data-i18n="rating">Reyting</div>
              <div class="stat-value" id="pv-rating">0.0 â­</div>
            </div>
            <div class="stat glass-soft">
              <div class="stat-label" data-i18n="points">Pointlar</div>
              <div class="stat-value" id="pv-points">0 ğŸ†</div>
            </div>
          </div>

          <div class="profile-actions">
            <button class="btn" onclick="openSheet('editProfileSheet')" data-i18n="edit_profile">Profilni tahrirlash</button>
            <button class="btn" onclick="openSheet('myAdsSheet')" data-i18n="my_ads">Mening eâ€™lonlarim</button>
          </div>
        </div>
      </section>

      <!-- ADMIN -->
      <section id="screen-admin" class="screen">
        <div class="sheet glass">
          <h2 class="sheet-title">ğŸ›¡ Admin Panel</h2>
          <p class="muted">Admin: eâ€™lonlar / banner / statistika</p>

          <div class="admin-grid">
            <button class="btn" onclick="adminRefresh()">ğŸ”„ Refresh</button>
            <button class="btn danger" onclick="adminClearAll()">ğŸ—‘ Clear ALL</button>
          </div>

          <div class="form-grid compact" style="margin-top:10px">
            <label class="field">
              <span>ğŸ“¢ Banner (qurilmadan yuklash)</span>
              <input id="bannerFile" type="file" accept="image/*" />
              <button class="btn primary full" onclick="adminUploadBanner()">Banner qoâ€˜yish (3s)</button>
            </label>
          </div>

          <div class="mini muted" id="adminStats">â€”</div>
        </div>
      </section>
    </main>

    <!-- BOTTOM NAV -->
    <nav class="bottom glass">
      <button class="nav-btn active" id="navHome" onclick="nav('home')">
        <div class="nav-ico">ğŸ </div>
        <div class="nav-txt" data-i18n="nav_home">Bosh</div>
      </button>

      <button class="nav-btn" id="navCreate" onclick="openSheet('createAdSheet')">
        <div class="nav-ico big">ï¼‹</div>
        <div class="nav-txt" data-i18n="nav_create">Yaratish</div>
      </button>

      <button class="nav-btn" id="navProfile" onclick="nav('profile')">
        <div class="nav-ico">ğŸ‘¤</div>
        <div class="nav-txt" data-i18n="nav_profile">Profil</div>
      </button>

      <button class="nav-btn" id="navSettings" onclick="openSheet('settingsSheet')">
        <div class="nav-ico">âš™ï¸</div>
        <div class="nav-txt" data-i18n="nav_settings">Sozlamalar</div>
      </button>
    </nav>
  </div>

  <!-- ===== SHEETS ===== -->

  <!-- CREATE AD -->
  <div id="createAdSheet" class="sheet-wrap" onclick="sheetOutside(event,'createAdSheet')">
    <div class="bottom-sheet glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title" data-i18n="create_ad">Eâ€™lon yaratish</div>
        <button class="icon-btn" onclick="closeSheet('createAdSheet')">âœ•</button>
      </div>

      <div class="form-grid compact">
        <div class="row2">
          <label class="field">
            <span data-i18n="point_a">TOCHKA A</span>
            <input id="ad-from" placeholder="Chirchiq" />
          </label>
          <label class="field">
            <span data-i18n="point_b">TOCHKA B</span>
            <input id="ad-to" placeholder="Sergeli" />
          </label>
        </div>

        <label class="field">
          <span data-i18n="ad_type">Tur</span>
          <select id="ad-type">
            <option value="now" data-i18n="type_now">SRAZU</option>
            <option value="20" data-i18n="type_20">20 daqiqada</option>
            <option value="fill" data-i18n="type_fill">Odam toâ€˜lsa</option>
          </select>
        </label>

        <div class="row2">
          <label class="field">
            <span data-i18n="price">Narx</span>
            <input id="ad-price" placeholder="10000" inputmode="numeric" />
          </label>
          <label class="field">
            <span data-i18n="seats">Boâ€˜sh joy</span>
            <input id="ad-seats" placeholder="3" inputmode="numeric" />
          </label>
        </div>

        <label class="field">
          <span data-i18n="comment">Izoh</span>
          <input id="ad-comment" placeholder="..." />
        </label>

        <div class="row2">
          <button class="btn primary" onclick="publishAd()" data-i18n="publish">Eâ€™lon berish</button>
          <button class="btn" onclick="closeSheet('createAdSheet')" data-i18n="close">Yopish</button>
        </div>

        <p class="muted small" data-i18n="auto_delete">
          Eâ€™lon 60 daqiqadan soâ€˜ng avtomatik oâ€˜chadi.
        </p>
      </div>
    </div>
  </div>

  <!-- SETTINGS -->
  <div id="settingsSheet" class="sheet-wrap" onclick="sheetOutside(event,'settingsSheet')">
    <div class="bottom-sheet glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title" data-i18n="settings">Sozlamalar</div>
        <button class="icon-btn" onclick="closeSheet('settingsSheet')">âœ•</button>
      </div>

      <div class="settings-list">
        <button class="setting-item" onclick="openSheet('langSheet')">
          ğŸŒ <span data-i18n="language">Til</span>
          <span class="right" id="langBadge">uz</span>
        </button>

        <div class="setting-item">
          ğŸ”Š <span data-i18n="sounds">Audio</span>
          <label class="switch">
            <input id="soundToggle" type="checkbox" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="setting-item">
          ğŸ“ <span data-i18n="geo">Geo</span>
          <label class="switch">
            <input id="geoToggle" type="checkbox" />
            <span class="slider"></span>
          </label>
        </div>

        <button class="setting-item admin-only" onclick="nav('admin')">
          ğŸ›¡ Admin Panel
          <span class="right">â†’</span>
        </button>
      </div>

      <div class="sheet-foot muted small">
        created by <b>711 GROUP</b>
      </div>
    </div>
  </div>

  <!-- LANGUAGE -->
  <div id="langSheet" class="sheet-wrap" onclick="sheetOutside(event,'langSheet')">
    <div class="bottom-sheet glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title" data-i18n="language">Til</div>
        <button class="icon-btn" onclick="closeSheet('langSheet')">âœ•</button>
      </div>
      <div class="stack">
        <button class="btn" onclick="setLang('uz'); closeSheet('langSheet')">Oâ€˜zbek</button>
        <button class="btn" onclick="setLang('ru'); closeSheet('langSheet')">Ğ ÑƒÑÑĞºĞ¸Ğ¹</button>
        <button class="btn" onclick="setLang('uzk'); closeSheet('langSheet')">Ğzbekcha</button>
      </div>
    </div>
  </div>

  <!-- GEO -->
  <div id="geoSheet" class="sheet-wrap" onclick="sheetOutside(event,'geoSheet')">
    <div class="bottom-sheet glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title">ğŸ“ <span data-i18n="geo">Geolokatsiya</span></div>
        <button class="icon-btn" onclick="closeSheet('geoSheet')">âœ•</button>
      </div>

      <div class="mini muted" id="geoStatus">â€”</div>

      <button class="btn primary full" onclick="updateLocationNow()" data-i18n="geo_update">
        Joylashuvni yangilash
      </button>

      <p class="muted small" data-i18n="geo_hint">
        Geo yoqilsa, eâ€™lonlar sizga yaqinligi boâ€˜yicha saralanadi.
      </p>
    </div>
  </div>

  <!-- SEARCH -->
  <div id="searchSheet" class="sheet-wrap" onclick="sheetOutside(event,'searchSheet')">
    <div class="bottom-sheet glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title">ğŸ” <span data-i18n="search">Qidirish</span></div>
        <button class="icon-btn" onclick="closeSheet('searchSheet')">âœ•</button>
      </div>

      <div class="form-grid compact">
        <label class="field">
          <span>Ism / Mashina / Route</span>
          <input id="searchInput" placeholder="Masalan: Cobalt, Toshkent, Azamat..." oninput="applySearch()" />
        </label>

        <button class="btn" onclick="clearSearch()">Tozalash</button>
      </div>
    </div>
  </div>

  <!-- EDIT PROFILE -->
  <div id="editProfileSheet" class="sheet-wrap" onclick="sheetOutside(event,'editProfileSheet')">
    <div class="bottom-sheet glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title" data-i18n="edit_profile">Profilni tahrirlash</div>
        <button class="icon-btn" onclick="closeSheet('editProfileSheet')">âœ•</button>
      </div>

      <div class="form-grid compact">
        <label class="field">
          <span data-i18n="full_name">Ism familiya</span>
          <input id="ep-name" />
        </label>

        <label class="field">
          <span data-i18n="phone">Telefon</span>
          <input id="ep-phone" />
        </label>

        <label class="field">
          <span data-i18n="car_brand">Mashina markasi</span>
          <input id="ep-car-brand" />
        </label>

        <label class="field">
          <span data-i18n="car_number">Mashina raqami</span>
          <input id="ep-car-number" />
        </label>

        <label class="field">
          <span data-i18n="photo_upload">Profil rasmi (qurilmadan)</span>
          <input id="ep-photo-file" type="file" accept="image/*" />
          <div class="preview-row">
            <div class="avatar-preview" id="ep-photo-preview"></div>
            <div class="mini muted">URL yoâ€˜q âœ…</div>
          </div>
        </label>

        <div class="row2">
          <button class="btn primary" onclick="saveProfileEdit()" data-i18n="save">Saqlash</button>
          <button class="btn" onclick="closeSheet('editProfileSheet')" data-i18n="close">Yopish</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MY ADS -->
  <div id="myAdsSheet" class="sheet-wrap" onclick="sheetOutside(event,'myAdsSheet')">
    <div class="bottom-sheet glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title" data-i18n="my_ads">Mening eâ€™lonlarim</div>
        <button class="icon-btn" onclick="closeSheet('myAdsSheet')">âœ•</button>
      </div>
      <div id="myAdsList" class="cards small-cards"></div>
    </div>
  </div>

  <!-- AD DETAIL MODAL -->
  <div id="adDetailModal" class="modal-wrap" onclick="closeAdDetail(event)">
    <div class="modal glass" onclick="event.stopPropagation()">
      <div class="sheet-head">
        <div class="sheet-head-title">ğŸ“Œ Eâ€™lon</div>
        <button class="icon-btn" onclick="closeAdDetail()">âœ•</button>
      </div>

      <div id="adDetailContent"></div>

      <div class="row2">
        <button class="btn primary" onclick="callFromDetail()">ğŸ“ Qoâ€˜ngâ€˜iroq</button>
        <button class="btn" onclick="msgFromDetail()">ğŸ’¬ Yozish</button>
      </div>
    </div>
  </div>

  <!-- ENTRY BANNER -->
  <div id="entryBanner" class="entry-banner hidden">
    <div class="entry-banner-card glass">
      <div class="entry-banner-img" id="entryBannerImg"></div>
      <div class="entry-banner-close">âœ¨</div>
    </div>
  </div>

  <script defer src="./app.js"></script>
</body>
</html>
